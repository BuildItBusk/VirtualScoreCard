@page "/newround"

@using GolfScoreUI.Data
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

@inject ProtectedLocalStorage ProtectedLocalStorage

<h3>Start a new round</h3>

<EditForm Model="@roundSettings" OnValidSubmit="@HandleValidSubmit">
<div class="form-group">
    <label for="maxStrokes">Maximum number of strokes per hole</label>
    <InputNumber class="form-control form-control-lg" id="maxStrokes" @bind-Value="roundSettings.MaxStrokesPerHole" />

    <label for="numberOfHoles">Number of holes</label>
    <InputNumber class="form-control form-control-lg" id="numberOfHoles" @bind-Value="roundSettings.NumberOfHoles" />

    <div class="form-group">
        <fieldset id="Players">
            <legend>Players</legend>
                @foreach (var element in roundSettings.Players.Select((p, i) => new { Player = p, Index = i }))
                {
                    <InputText id="@($"player-{element.Index+1}")" placeholder="@($"Player {element.Index+1}")" class="form-control mb-2" @bind-Value="@element.Player.Name" />
                }
        </fieldset>
    </div>
    <button type="submit" class="btn btn-primary">Start round</button>
</div>
</EditForm>

@code {
    private RoundSettings roundSettings = new();

    private async Task HandleValidSubmit()
    {
        var players = new List<Player>
        {
            new Player { Name = "Foo" },
            new Player { Name = "Bar" },
            new Player { Name = "Bas" }
        };

        var scorecard = new Scorecard(numberOfHoles: 9, maxStrokes: 8, players);
        await ProtectedLocalStorage.SetAsync("scorecard", scorecard);
    }

}
